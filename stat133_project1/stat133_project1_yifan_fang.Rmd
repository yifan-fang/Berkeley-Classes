---
title: "yifan-fang-project1"
author: "Yifan Fang"
date: "2/27/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
```
#### video link: "https://drive.google.com/file/d/1iGGm-CWFldIm3K5f3uwSS2tWenT6qSiB/view?usp=sharing"

# A) Data IBTrACS
## A.1) Recommended R Packages
```{r}
library(tidyverse) # includes dplyr, ggplot2 and other pkgs
library(lubridate) # for working with dates
library(spData) # contains "world" data for maps
library(gganimate) # for animated graphs (and maps)
```

## A.2) Importing Data in R
```{r}
# create variables for column names and column types
column_names = c("SID", "SEASON", "NUMBER", "BASIN", "SUBBASIN", "NAME", "ISO_TIME", "NATURE", "LAT", "LON", "WMO_WIND", "WMO_PRES", "WMO_AGENCY", "TRACK_TYPE", "DIST2LAND", "LANDFALL")
column_types = c("character", "integer", "integer", "character", "character", "character", "character", "character", "real", "real", "integer", "integer", "character", "character", "integer", "integer")
#import the data we want in this project
dat = read.csv(file = "ibtracs.NA.list.v04r00.csv", 
         colClasses = c(column_types, rep("NULL", 147)),
         col.names = c(column_names, rep("NULL", 147)),
         header = TRUE,
         stringsAsFactors = FALSE,
         skip = 77876, #years after 1970
         na.strings = c("", "MM")) #missing data are encoded as "" or "MM"
head(dat)
```
## A.3) Adding a MONTH column
```{r}
# adding column month
dat$ISO_TIME = as.POSIXct(dat$ISO_TIME)
dat$MONTH <- lubridate::month(dat$ISO_TIME)
# display structure of your data with this command
str(dat, vec.len = 1)
```
# B) Univariate Exploratory Data Analysis
### This part is not included in the report

# C) Main Analysis
## C1) Atlantic Hurricane Seasons

### C1.a)
```{r}
#filter out the tropical cyclones in 2020 and in both north atlantic and south atlantic
TS2020 = dat %>% 
  filter(SEASON == 2020 & (NATURE == 'TS' | NATURE == 'SS') & (BASIN == 'NA' | BASIN == 'SA'))
#get the number of named tropical cyclones
nrow(TS2020 %>% distinct(NAME))
nrow(TS2020 %>% distinct(NAME) %>% filter(NAME != 'NOT_NAMED'))
#get the number of pre-season formed tropical cyclones
nrow(TS2020 %>% filter(MONTH < 6) %>% filter(NAME != 'NOT_NAMED') %>% distinct(NAME))
```
#### Firstly, we create a dataframe TS2020 with filtered year, kinds of storms, and region, which we set to 2020, tropical cyclones (TS) and subtropical cyclones (SS), north atlantic (NA) and south atlantic (SA) respectively. Secondly, we get the number of tropical cyclones using the function nrow to get the number of rows and distinct to distinct the names. As a result, we get 31 tropical cyclones total and 30 named ones out of the total number. Lastly, the 2020 Atlantic hurricane season starts on June 1 and ends on November 30. We check the number of tropical cyclones formed preseason using the function nrow to get the number of rows, filter to filter month and named storms, and distinct to distinct the names on dataframe TS2020. According to the data, there are two tropical cyclones formed pre-June, so they are formed pre-season. Hence, the first half of claim is correct: "30 out of 31 (which corresponds to all but one) tropical cyclones (including subtropical cyclones) became named storms in the 2020 Atlantic hurricane season." However, the second half is incorrect.

### C1.b)
```{r}
#get the number of major hurricanes
nrow(TS2020 %>% filter(WMO_WIND >= 96) %>% distinct(NAME) %>% filter(NAME != 'NOT_NAMED'))
#get the number of category 5 hurricanes
nrow(TS2020 %>% filter(WMO_WIND >= 137) %>% distinct(NAME) %>% filter(NAME != 'NOT_NAMED'))
```
#### Major hurricanes are tropical cyclones that have a speed of 96 knots or more, and hurricanes in category 5 have a speed of 137 knots or more. Firstly, we apply functions nrow to get the number of rows, filter to filter out wind speed greater or equal to 96 knots and named storms, and distinct to distinct the names of the hurricanes; together we can find the number of major hurricanes, which is 7. Then, we use the same method to find number of hurricanes in category 5, and we get 0. Hence, the claim is correct.

### C1.c) 
```{r}
#get the number of named storms in the 2010 Atlantic hurricane season
storms2010 = dat %>% 
  filter(SEASON == 2010 & (BASIN == 'NA' | BASIN == 'SA') & NAME != 'NOT_NAMED')
nrow(storms2010 %>% distinct(NAME))
#get the hurricanes in the 2010 Atlantic hurricane season
hurricane2010 = storms2010 %>% filter(WMO_WIND >= 64)
#define the world map
gg_world = ggplot() + 
  geom_polygon(data = map_data('world'), 
               aes(x = long, y = lat, group = group), 
               fill = "gray95", colour = "gray70", size = 0.2) +
  theme_bw()
#plot the latitudes as x-axis and longitudes as y-axis on the map
gg_world + 
  geom_point(data = hurricane2010, aes(x = LON, y = LAT, color = NAME), size = 0.02) +
   xlim(c(-150, 0)) + 
   ylim(c(0, 90)) + 
   labs(title = "Hurricanes in the 2010 Atlantic hurricane season", x = 'longitude', y = 'latituede')
```

#### Firstly, we create a dataframe storms2010 with filtered year, region, and named storms, which we set to 2010, north atlantic (NA) and south atlantic (SA), and not equal to "NOT_NAMED" respectively. Then we use nrow to get the number of named storms in the 2010 Atlantic hurricane season. Secondly, we create a dataframe of hurricanes by using filter to filter the speed greater than 64 knots on storms2010. Next, we use ggplot and the map data to draw the world map, with zooming in the Atlantic area. Then we plot the hurricane's longitudes on x-axis and latitudes on y-axis on the map. According to the plotted map, there's no hurricane hit the United States. So this claim is correct.

### C1.d) 
```{r}
#create a data frame for the 2005 Atlantic hurricane season
storms2005 = dat %>% 
  filter(SEASON == 2005 & (BASIN == 'NA' | BASIN == 'SA') & NAME != 'NOT_NAMED')
#get the number of named storms in 2005
nrow(storms2005 %>% distinct(NAME))
#get the number of major hurricanes in 2005
nrow(storms2005 %>% filter(WMO_WIND >= 96) %>% distinct(NAME))
#list the number of major hurricanes in each year from 1970 to 2020
major_hurricanes_count_by_year = dat %>% 
  group_by(SEASON) %>% 
    filter((BASIN == 'NA' | BASIN == 'SA') & WMO_WIND >= 96) %>%
      distinct(NAME) %>% 
        summarise(n())
#get the max number of major hurricanes
max(major_hurricanes_count_by_year %>% pull(var = -1))
```
#### Firstly, we create a data frame TS2005 for the 2005 Atlantic hurricane season that filters the year (SEASON) to 2005, region (BASIN) to north atlantic and south atlantic, and name not equals "NOT_NAMED." Next, using functions nrow and distinct, we get 27 named storms. Then, we can filter the wind speed which is "WMO_WIND" greater than 96, and with nrow and distinct we can see seven storms became major hurricanes. By grouping the years and a set of filters, we get the number of major hurricanes in each year from 1970 to 2020. We can see seven is the maximum number of major hurricanes using the funtion max, which corresponds to the number of major hurricanes in 2005. Hence, this claim is correct. 

### C1.e)
```{r}
#list the number of tropical cyclones in each year from 1970 to 2020 and sort them in decreasing order
TS_count_by_year = dat %>% 
  group_by(SEASON) %>% 
    filter((NATURE == 'TS' | NATURE == 'SS') & (BASIN == 'NA' | BASIN == 'SA')) %>%
      distinct(NAME) %>% 
        summarise(n())
#get the max number of tropical cyclones during the period 1970 to 2020
max(TS_count_by_year %>% pull(var = -1))
```
#### First of all, according to previous data, we know that the 2020 Atlantic hurricane season has 31 tropical cyclones. We then create a dataframe TS_count_by_year to see the number of tropical cyclones in each year by filtering the storm types and regions, distincting name, and summarizing the counts. From the dataframe, we use the function max to find the maximum number of tropical cyclones in the count column, which is 31 and corresponds to the number in 2020. Hence, this claim is correct.

### C1.f)
```{r}
#list the number of hurricanes in each year from 1970 to 2020
hurricane_count_by_year = dat %>%
    group_by(SEASON) %>%
      filter ((BASIN == 'NA' | BASIN == 'SA') & WMO_WIND >= 64) %>%
        distinct(NAME) %>% 
          summarise(n())
#get the number of hurricanes in the 2020 Atlantic hurricane season
nrow(TS2020 %>% filter(WMO_WIND >= 64) %>% distinct(NAME))
#get the max number of hurricanes during the period 1970 to 2020
max(hurricane_count_by_year %>% pull(var = -1))
```
#### We first create a dataframe hurricane_count_by_year to see the number of hurricanes in each year by filtering the regions and wind speed, distincting name, and summarizing the counts. Then, we get the number of hurricanes in the 2020 Atlantic hurricane season using nrows on the speed-filtered and name-distincted dataframe. The data shows that there are 14 hurricanes in the 2020 Atlantic season. In the end, we get the max number of hurricanes during the period 1970 to 2020 using max on the hurricane_count_by_year dataframe. We find that the year with the most number of hurricanes has 15 hurricanes, which is greater than 14, so the 2020 Atlantic hurricane season is not the season with the most number of hurricanes during the period 1970 to 2020. Hence, the first part of the claim is correct that there are 14 hurricanes in the 2020 Atlantic season, but the second part is incorrect because it doesn't have the most number of hurricanes. 

## C.2) Animated Map
```{r}
#get all storms in 2020
storms_2020 = dat %>% filter(SEASON == 2020)
#plot all storms in 2020
storms_2020_plot = gg_world + geom_point(data = storms_2020, aes(x = LON, y = LAT, size = WMO_WIND, color = NAME))
#animate the plot
animated_storms_2020 = storms_2020_plot + 
  transition_states(NAME, transition_length = 2, state_length = 1) +
  transition_time(ISO_TIME) +
  labs(title = '2020 Atlantic Season Storms Trajectory', subtitle = 'Days: {frame_time}', x = 'longitude', y = 'latituede') +
  xlim(c(-150, 10)) + 
  ylim(c(0, 90))
animate(animated_storms_2020, fps=5)
```

#### For the animation, we first create a dataframe that contains all storms in 2020 by filtering the year. Next, we use the same world map created before, and plot the longitudes and latitudes of 2020 storms on the map using geom_point, naming this static plot storms_2020_plot. We then make an animated plot called animated_storms_2020 based on the storms_2020_plot. We use transition_states to indicate their trajectory, transition_time to indicate the time change, labs to label the plot, and xlim and ylim to zoom in the plot. In the end, we use animate to call the animated graph and set its speed to fps = 5. This animated graph shows the tragectories of the storms in 2020 based on time, the wind speed change based on the size of the point (the bigger the faster), and all storms are color-coded by their names. From this graph, we can see that there are two storms formed preseaon (earlier than June) and there's peak of storms in the mid of September. We can also see many storms landed on the United States, Canada, and also some other countries in North America, Europe, and Africa.




